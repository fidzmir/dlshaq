-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

-- Variables
local LocalPlayer = Players.LocalPlayer
local EventsFolder = ReplicatedStorage:WaitForChild("Events")

-- Konfigurasi
_G.AutoAttackEnabled = false
_G.SpeedEnabled = false
_G.ESPEnabled = true
_G.SpeedMultiplier = 1

local BASE_SPEED = 16
local MAX_SPEED_CAP = 45    
local ATTACK_RANGE = 200
local ATTACK_SPEED = 0.015 -- Fast attack rate

-- 1. Remote Hunter: Finds the highest version (AttackV1, V2, V3...)
local function GetCurrentAttackRemote()
    local bestRemote = nil
    local highestVersion = -1

    for _, v in pairs(EventsFolder:GetChildren()) do
        if v.Name:find("Attack") then
            local version = tonumber(v.Name:match("%d+"))
            if version and version > highestVersion then
                highestVersion = version
                bestRemote = v
            end
        end
    end
    return bestRemote or EventsFolder:FindFirstChild("AttackV2") or EventsFolder:FindFirstChild("Attack")
end

-- 2. Improved Target Filter: Ignores ALL Players (Friends & Self)
local function isValidEnemy(target)
    if target and target:FindFirstChild("Humanoid") and target.Humanoid.Health > 0 then
        -- CRITICAL: This line prevents hitting your friend or yourself
        if Players:GetPlayerFromCharacter(target) then 
            return false 
        end 
        
        local targetName = target.Name:lower()
        local isNPCAttr = target:GetAttribute("IsNPC")
        local mobLevel = target:GetAttribute("MobLevel")
        
        -- Filter out shopkeepers or specific NPCs that aren't enemies
        if targetName:find("npc") and not mobLevel then
            return false
        end

        -- If it's explicitly marked as an NPC or has a Level, it's a target
        if isNPCAttr == true or mobLevel ~= nil then
            return true
        end
        
        return true -- Generic fallback for mob folders
    end
    return false
end

-- 3. ESP Highlight Logic
local function ApplyESP(target)
    if not target:FindFirstChild("MobHighlight") then
        local highlight = Instance.new("Highlight")
        highlight.Name = "MobHighlight"
        highlight.Adornee = target
        highlight.FillColor = Color3.fromRGB(255, 0, 0)
        highlight.FillTransparency = 0.5
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.Parent = target
        
        local hum = target:FindFirstChild("Humanoid")
        if hum then
            hum.Died:Connect(function() 
                if highlight then highlight:Destroy() end 
            end)
        end
    end
end

-- 4. Main Loop: Attack and ESP
task.spawn(function()
    local currentRemote = GetCurrentAttackRemote()
    
    -- Update the
